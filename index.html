<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>proppli ‚Äî Property Operations Software</title>
    <link rel="icon" type="image/png" href="assets/images/logos/LogoOnly.png">
    <!-- Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-functions-compat.js"></script>
</head>
<body>
    <!-- Authentication Pages -->
    <div id="authPages" style="display: none;">
        <!-- Login Page -->
        <div id="loginPage" class="auth-page">
            <div class="auth-container">
                <div class="auth-header">
                    <img src="assets/images/logos/Logo+Word.png" alt="proppli" class="auth-logo" height="40">
                </div>
                <div class="auth-card">
                    <h2>Sign In</h2>
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="loginEmail">Email</label>
                            <input type="email" id="loginEmail" required autocomplete="email">
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <div class="password-input-wrapper">
                                <input type="password" id="loginPassword" required autocomplete="current-password">
                                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('loginPassword', this)" aria-label="Show password">
                                    <span class="eye-icon">üëÅÔ∏è</span>
                                </button>
                            </div>
                        </div>
                        <div class="form-group checkbox-group">
                            <label>
                                <input type="checkbox" id="rememberMe">
                                <span>Remember Me</span>
                            </label>
                        </div>
                        <button type="submit" class="auth-button">Sign In</button>
                        <div style="margin: 20px 0; text-align: center; position: relative;">
                            <div style="border-top: 1px solid #e5e7eb; margin: 20px 0;"></div>
                            <span style="background: white; padding: 0 15px; color: #6b7280; font-size: 0.9rem; position: relative; top: -10px;">OR</span>
                        </div>
                        <button type="button" class="auth-button" id="googleSignInBtn" style="background: white; color: #333; border: 1px solid #d1d5db; display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <svg width="18" height="18" viewBox="0 0 18 18">
                                <path fill="#4285F4" d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844c-.209 1.125-.843 2.078-1.796 2.717v2.258h2.908c1.702-1.567 2.684-3.874 2.684-6.615z"/>
                                <path fill="#34A853" d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.258c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332C2.438 15.983 5.482 18 9 18z"/>
                                <path fill="#FBBC05" d="M3.964 10.707c-.18-.54-.282-1.117-.282-1.707s.102-1.167.282-1.707V4.951H.957C.348 6.174 0 7.55 0 9s.348 2.826.957 4.049l3.007-2.342z"/>
                                <path fill="#EA4335" d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0 5.482 0 2.438 2.017.957 4.951L3.964 7.293C4.672 5.158 6.656 3.58 9 3.58z"/>
                            </svg>
                            Sign in with Google
                        </button>
                        <div class="auth-links">
                            <a href="#" id="forgotPasswordLink">Forgot Password?</a>
                            <a href="#" id="showSignupLink">Don't have an account? Sign Up</a>
                        </div>
                    </form>
                    <div id="loginError" class="auth-error" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Sign Up Page -->
        <div id="signupPage" class="auth-page" style="display: none;">
            <div class="auth-container">
                <div class="auth-header">
                    <img src="assets/images/logos/Logo+Word.png" alt="proppli" class="auth-logo" height="40">
                </div>
                <div class="auth-card">
                    <h2>Create Account</h2>
                    <form id="signupForm">
                        <div class="form-group">
                            <label for="signupEmail">Email</label>
                            <input type="email" id="signupEmail" required autocomplete="email">
                        </div>
                        <div class="form-group">
                            <label for="signupPassword">Password</label>
                            <div class="password-input-wrapper">
                                <input type="password" id="signupPassword" required autocomplete="new-password">
                                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('signupPassword', this)" aria-label="Show password">
                                    <span class="eye-icon">üëÅÔ∏è</span>
                                </button>
                            </div>
                            <small class="password-hint">Must be at least 8 characters with uppercase, lowercase, number, and special character</small>
                        </div>
                        <div class="form-group">
                            <label for="signupPasswordConfirm">Confirm Password</label>
                            <div class="password-input-wrapper">
                                <input type="password" id="signupPasswordConfirm" required autocomplete="new-password">
                                <button type="button" class="password-toggle" onclick="togglePasswordVisibility('signupPasswordConfirm', this)" aria-label="Show password">
                                    <span class="eye-icon">üëÅÔ∏è</span>
                                </button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="signupFullName">Full Name</label>
                            <input type="text" id="signupFullName" required autocomplete="name">
                        </div>
                        <div class="form-group">
                            <label for="signupPhone">Phone (Optional)</label>
                            <input type="tel" id="signupPhone" autocomplete="tel">
                        </div>
                        <button type="submit" class="auth-button">Create Account</button>
                        <div class="auth-links">
                            <a href="#" id="showLoginLink">Already have an account? Sign In</a>
                        </div>
                    </form>
                    <div id="signupError" class="auth-error" style="display: none;"></div>
                    <div id="signupSuccess" class="auth-success" style="display: none;">
                        <p>Account created successfully! Your account is pending admin approval. You'll receive an email when it's activated.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Password Reset Page -->
        <div id="passwordResetPage" class="auth-page" style="display: none;">
            <div class="auth-container">
                <div class="auth-header">
                    <img src="assets/images/logos/Logo+Word.png" alt="proppli" class="auth-logo" height="40">
                </div>
                <div class="auth-card">
                    <h2>Reset Password</h2>
                    <form id="passwordResetForm">
                        <div class="form-group">
                            <label for="resetEmail">Email</label>
                            <input type="email" id="resetEmail" required autocomplete="email">
                        </div>
                        <button type="submit" class="auth-button">Send Reset Link</button>
                        <div class="auth-links">
                            <a href="#" id="backToLoginLink">Back to Sign In</a>
                        </div>
                    </form>
                    <div id="resetError" class="auth-error" style="display: none;"></div>
                    <div id="resetSuccess" class="auth-success" style="display: none;">
                        <p>Password reset link has been sent to your email. Please check your inbox.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Landing Page -->
    <div id="landingPage" class="landing-page">
        <div class="landing-header">
            <button id="launchAppBtn" class="launch-app-btn">Launch Application</button>
        </div>
        <div class="landing-content">
            <div class="landing-hero">
                <div class="hero-title-container">
                    <img src="assets/images/logos/LogoOnly.png" alt="proppli" class="hero-logo" height="80">
                    <h1 class="landing-title">proppli</h1>
                </div>
                <p class="landing-tagline">Your Real Estate, Managed Proppli üè¢</p>
                <p class="landing-subtitle">Comprehensive property management software for modern real estate operations</p>
            </div>
            
            <div class="landing-features">
                <div class="feature-card">
                    <div class="feature-icon">üîß</div>
                    <h3>Maintenance Tracking</h3>
                    <p>Streamline work orders, track progress, and manage maintenance requests efficiently</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üè¢</div>
                    <h3>Property Management</h3>
                    <p>Organize properties, buildings, and units with detailed information and documentation</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üë•</div>
                    <h3>Tenant Relations</h3>
                    <p>Manage tenant information, contacts, and relationships all in one place</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üìÑ</div>
                    <h3>Lease Management</h3>
                    <p>Track leases, escalations, renewals, and all lease-related documentation</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üí∞</div>
                    <h3>Financial Tools</h3>
                    <p>Generate rent rolls, track revenue, and manage financial reporting</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üìä</div>
                    <h3>Analytics & Insights</h3>
                    <p>Get insights into your portfolio performance with comprehensive reporting</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Container (hidden initially) -->
    <div id="appContainer" class="app-container" style="display: none;">
    <div class="app-layout">
        <!-- Left Sidebar Navigation -->
        <aside class="sidebar-nav" id="sidebarNav">
            <div class="sidebar-brand">
                <img src="assets/images/logos/Logo+Word.png" alt="proppli" class="sidebar-logo" height="48">
                <button class="sidebar-toggle" id="sidebarToggle" aria-label="Toggle sidebar" title="Collapse sidebar">
                    <span class="sidebar-toggle-icon">‚óÄ</span>
                </button>
            </div>
            <nav class="sidebar-nav-links">
                <button class="sidebar-nav-link active" data-page="maintenance" title="Maintenance">
                    <span class="nav-icon">üîß</span>
                    <span class="nav-label">Maintenance</span>
                </button>
                <button class="sidebar-nav-link" data-page="properties" title="Properties">
                    <span class="nav-icon">üè¢</span>
                    <span class="nav-label">Properties</span>
                </button>
                <button class="sidebar-nav-link" data-page="tenants" title="Tenants">
                    <span class="nav-icon">üë•</span>
                    <span class="nav-label">Tenants</span>
                </button>
                <button class="sidebar-nav-link" data-page="leases" title="Leases">
                    <span class="nav-icon">üìÑ</span>
                    <span class="nav-label">Leases</span>
                </button>
                <button class="sidebar-nav-link" data-page="finance" title="Finance">
                    <span class="nav-icon">üí∞</span>
                    <span class="nav-label">Finance</span>
                </button>
                <button class="sidebar-nav-link" data-page="users" id="usersNavLink" style="display: none;" title="Users">
                    <span class="nav-icon">üë§</span>
                    <span class="nav-label">Users</span>
                </button>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <div class="main-content-wrapper">
            <!-- Top Bar with User Menu -->
            <header class="top-bar">
                <div class="top-bar-content">
                    <h1 class="page-title" id="currentPageTitle">Maintenance</h1>
                    <div class="nav-user-menu">
                        <div class="user-menu-dropdown">
                            <button class="user-menu-btn" id="userMenuBtn">
                                <span id="userMenuName">User</span>
                                <span class="dropdown-arrow">‚ñº</span>
                            </button>
                            <div class="user-menu-dropdown-content" id="userMenuDropdown">
                                <a href="#" id="profileBtn">Profile</a>
                                <a href="#" id="logoutBtn">Sign Out</a>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Page Content Container -->
            <div class="container">

        <!-- Maintenance Tracker Page -->
        <div id="maintenancePage" class="page active">
            <header>
                <h2>Maintenance</h2>
                <div class="header-actions">
                    <div class="property-selector">
                        <label for="propertySelect">Property:</label>
                        <select id="propertySelect">
                            <option value="">Select a property...</option>
                        </select>
                    </div>
                </div>
            </header>

            <main>

            <!-- Ticket Creation Modal -->
            <div id="ticketModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Create Maintenance Ticket</h2>
                        <button class="close-btn" id="closeTicketModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="ticketForm">
                            <input type="hidden" id="ticketId">
                            <div class="form-group">
                                <label for="ticketProperty">Property *</label>
                                <select id="ticketProperty" required></select>
                            </div>
                            <div id="commercialFieldsGroup" style="display: none;">
                                <div class="form-group">
                                    <label for="buildingNumber">Building #</label>
                                    <input type="text" id="buildingNumber" placeholder="e.g., Building 1">
                                </div>
                                <div class="form-group">
                                    <label for="unitNumber">Unit #</label>
                                    <input type="text" id="unitNumber" placeholder="e.g., Unit 101">
                                </div>
                                <div class="form-group">
                                    <label for="floorNumber">Floor #</label>
                                    <input type="text" id="floorNumber" placeholder="e.g., Floor 2">
                                </div>
                                <div class="form-group">
                                    <label for="ticketTenantSelect">Tenant</label>
                                    <select id="ticketTenantSelect">
                                        <option value="">Select a tenant...</option>
                                        <option value="__manual__">Enter manually</option>
                                    </select>
                                    <input type="text" id="tenantName" placeholder="e.g., ABC Company" style="display: none; margin-top: 8px;">
                                    <input type="hidden" id="ticketTenantId">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="workDescription">Work Description *</label>
                                <textarea id="workDescription" rows="4" required></textarea>
                            </div>
                            <div class="form-group">
                                <label for="detailedDescription">Detailed Description (Optional)</label>
                                <textarea id="detailedDescription" rows="6" placeholder="Add any additional context, notes, or detailed information about this maintenance request..."></textarea>
                                <small style="color: #666; font-size: 12px;">Use this field to provide more context, specific instructions, or additional details about the work needed.</small>
                            </div>
                            <div class="form-group">
                                <label for="workUpdates">Work Updates / Notes</label>
                                <textarea id="workUpdates" rows="4" placeholder="Add notes about work progress, updates, or changes as the ticket progresses..."></textarea>
                                <small style="color: #666; font-size: 12px;">Use this field to track progress notes and updates as work is being completed on in-progress items.</small>
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 8px;">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="enableTimeAllocation">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <span style="font-weight: 600;">Enable Time Allocation</span>
                                </label>
                                <div id="timeAllocationGroup" style="display: none;">
                                    <label for="timeAllocated">Time Allocated (hours)</label>
                                    <input type="number" id="timeAllocated" min="0" step="0.5" placeholder="Required before marking complete">
                                    <small style="color: #666; font-size: 12px;">Time allocation must be set before marking ticket as complete</small>
                                    <div style="margin-top: 15px;">
                                        <label>Billing Type</label>
                                        <div style="display: flex; gap: 20px; margin-bottom: 10px;">
                                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                                                <input type="radio" name="billingType" id="billingTypeHourly" value="hourly" checked>
                                                <span>Hourly Rate</span>
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                                                <input type="radio" name="billingType" id="billingTypeFlat" value="flat">
                                                <span>Flat Rate</span>
                                            </label>
                                        </div>
                                        <label for="billingRate" id="billingRateLabel">Billing Rate ($/hour)</label>
                                        <input type="number" id="billingRate" min="0" step="0.01" placeholder="e.g., 75.00">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="ticketCreatedBy">Created By</label>
                                <input type="text" id="ticketCreatedBy" readonly style="background-color: #f3f4f6; cursor: not-allowed;">
                                <small style="color: #666; font-size: 12px;">Automatically set to current user</small>
                            </div>
                            <div class="form-group">
                                <label for="requestedBy">Requested By *</label>
                                <select id="requestedBy" required>
                                    <option value="">Select a user...</option>
                                    <option value="__other__">Other (enter manually)</option>
                                </select>
                                <input type="text" id="requestedByOther" placeholder="Enter name manually" style="display: none; margin-top: 8px;">
                            </div>
                            <div class="form-group">
                                <label for="managedBy">Managed By *</label>
                                <select id="managedBy" required>
                                    <option value="">Select a user...</option>
                                    <option value="__other__">Other (enter manually)</option>
                                </select>
                                <input type="text" id="managedByOther" placeholder="Enter name manually" style="display: none; margin-top: 8px;">
                            </div>
                            <div class="form-group">
                                <label for="assignedTo">Assigned To</label>
                                <select id="assignedTo">
                                    <option value="">Unassigned</option>
                                    <option value="__other__">Other (enter manually)</option>
                                </select>
                                <input type="text" id="assignedToOther" placeholder="Enter name manually" style="display: none; margin-top: 8px;">
                            </div>
                            <div class="form-group">
                                <label for="ticketStatus">Status</label>
                                <select id="ticketStatus">
                                    <option value="Not Started">Not Started</option>
                                    <option value="In Progress">In Progress</option>
                                    <option value="Monitoring">Monitoring</option>
                                    <option value="Completed">Completed</option>
                                </select>
                            </div>
                            <div class="form-group" id="monitoringFieldsGroup" style="display: none;">
                                <label style="font-weight: 600; color: #2563EB;">Monitoring Information</label>
                                <small style="display: block; color: #6B7280; margin-bottom: 12px;">Add invoices or proposals for future work on this ticket</small>
                                <div class="form-group">
                                    <label for="invoiceUrl">Invoice URL/Link</label>
                                    <input type="url" id="invoiceUrl" placeholder="https://...">
                                    <small style="color: #6B7280; font-size: 12px;">Link to invoice or proposal document</small>
                                </div>
                                <div class="form-group">
                                    <label for="invoiceNotes">Invoice/Proposal Notes</label>
                                    <textarea id="invoiceNotes" rows="3" placeholder="Notes about the invoice or proposal, estimated costs, timeline, etc."></textarea>
                                </div>
                            </div>
                            <div class="form-group" id="retroactiveDatesGroup" style="display: none;">
                                <label style="font-weight: 600; color: #667eea;">Retroactive Ticket Dates (Optional)</label>
                                <small style="display: block; color: #666; margin-bottom: 10px;">Use this for previously completed work</small>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div>
                                        <label for="customDateCreated" style="font-size: 14px;">Date Created</label>
                                        <input type="date" id="customDateCreated">
                                    </div>
                                    <div>
                                        <label for="customDateCompleted" style="font-size: 14px;">Date Completed</label>
                                        <input type="date" id="customDateCompleted">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Before Photo (Optional)</label>
                                <div class="file-upload-section" style="grid-template-columns: 1fr;">
                                    <div class="file-upload-item" id="beforePhotoDropZone">
                                        <label for="beforePhoto" class="file-upload-label">
                                            <span class="file-upload-icon">üì∑</span>
                                            <span>Upload Before Photo</span>
                                            <span style="display: block; margin-top: 8px; font-size: 12px; color: #666;">or drag and drop files here</span>
                                        </label>
                                        <input type="file" id="beforePhoto" accept="image/*" style="display: none;">
                                        <div id="beforePhotoPreview" class="file-preview"></div>
                                        <button type="button" class="btn-remove-file" id="removeBeforePhoto" style="display: none;">Remove</button>
                                    </div>
                                </div>
                                <small style="color: #666; font-size: 12px;">Upload a photo showing the issue before work begins</small>
                            </div>
                            <div class="form-group" id="completedByGroup" style="display: none;">
                                <label for="completedBy">Completed By *</label>
                                <select id="completedBy">
                                    <option value="">Select a user...</option>
                                    <option value="__other__">Other (enter manually)</option>
                                </select>
                                <input type="text" id="completedByOther" placeholder="Enter name manually" style="display: none; margin-top: 8px;">
                            </div>
                            <div class="form-group" id="howResolvedGroup" style="display: none;">
                                <label for="howResolved">How Resolved</label>
                                <textarea id="howResolved" rows="3" placeholder="Describe how the issue was resolved..."></textarea>
                            </div>
                            <div class="form-group" id="afterPhotoGroup" style="display: none;">
                                <label>After Photo (Optional)</label>
                                <div class="file-upload-section" style="grid-template-columns: 1fr;">
                                    <div class="file-upload-item" id="afterPhotoDropZone">
                                        <label for="afterPhoto" class="file-upload-label">
                                            <span class="file-upload-icon">üì∑</span>
                                            <span>Upload After Photo</span>
                                            <span style="display: block; margin-top: 8px; font-size: 12px; color: #666;">or drag and drop files here</span>
                                        </label>
                                        <input type="file" id="afterPhoto" accept="image/*" style="display: none;">
                                        <div id="afterPhotoPreview" class="file-preview"></div>
                                        <button type="button" class="btn-remove-file" id="removeAfterPhoto" style="display: none;">Remove</button>
                                    </div>
                                </div>
                                <small style="color: #666; font-size: 12px;">Upload a photo showing the completed work</small>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn-primary">Save Ticket</button>
                                <button type="button" class="btn-secondary" id="cancelTicketForm">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Loading Modal -->
            <div id="loadingModal" class="modal">
                <div class="modal-content" style="max-width: 400px; text-align: center;">
                    <div class="modal-body" style="padding: 40px 20px;">
                        <div class="loading-spinner" style="width: 50px; height: 50px; margin: 0 auto 20px; border: 4px solid #f3f3f3; border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite;"></div>
                        <h3 style="color: #667eea; margin-bottom: 10px;">Saving Ticket...</h3>
                        <p style="color: #666;">Please wait while we save your changes</p>
                    </div>
                </div>
            </div>

            <!-- Delete Ticket Modal -->
            <div id="deleteTicketModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Delete Ticket</h2>
                        <button class="close-btn" id="closeDeleteTicketModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="deleteTicketForm">
                            <div class="form-group">
                                <label for="deleteReason">Reason for Deletion *</label>
                                <textarea id="deleteReason" rows="4" required placeholder="Please provide a reason for deleting this ticket..."></textarea>
                                <small style="color: #666; font-size: 12px;">This ticket will be moved to the deleted section and permanently removed after 30 days.</small>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn-danger">Delete Ticket</button>
                                <button type="button" class="btn-secondary" id="cancelDeleteTicketForm">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Advance Workflow Modal -->
            <div id="completionModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 id="workflowModalTitle">Advance Workflow</h2>
                        <button class="close-btn" id="closeCompletionModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="completionForm">
                            <input type="hidden" id="workflowTargetStatus" value="">
                            <div class="form-group">
                                <label for="completionCompletedBy">Completed By *</label>
                                <select id="completionCompletedBy" required>
                                    <option value="">Select a user...</option>
                                    <option value="__other__">Other (enter manually)</option>
                                </select>
                                <input type="text" id="completionCompletedByOther" placeholder="Enter name manually" style="display: none; margin-top: 8px;">
                            </div>
                            <div class="form-group">
                                <label for="completionHowResolved">How Resolved</label>
                                <textarea id="completionHowResolved" rows="3" placeholder="Describe how the issue was resolved..."></textarea>
                            </div>
                            <div class="form-group" id="workflowTimeAllocationGroup" style="display: none;">
                                <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 8px;">
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="workflowEnableTimeAllocation">
                                        <span class="toggle-slider"></span>
                                    </label>
                                    <span style="font-weight: 600;">Enable Time Allocation</span>
                                </label>
                                <div id="workflowTimeAllocationFields" style="display: none;">
                                    <label for="workflowTimeAllocated">Time Allocated (hours)</label>
                                    <input type="number" id="workflowTimeAllocated" min="0" step="0.5" placeholder="Required before marking complete">
                                    <small style="color: #666; font-size: 12px;">Time allocation must be set before marking ticket as complete</small>
                                    <div style="margin-top: 15px;">
                                        <label>Billing Type</label>
                                        <div style="display: flex; gap: 20px; margin-bottom: 10px;">
                                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                                                <input type="radio" name="workflowBillingType" id="workflowBillingTypeHourly" value="hourly" checked>
                                                <span>Hourly Rate</span>
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                                                <input type="radio" name="workflowBillingType" id="workflowBillingTypeFlat" value="flat">
                                                <span>Flat Rate</span>
                                            </label>
                                        </div>
                                        <label for="workflowBillingRate" id="workflowBillingRateLabel">Billing Rate ($/hour)</label>
                                        <input type="number" id="workflowBillingRate" min="0" step="0.01" placeholder="e.g., 75.00">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>After Photo (Optional)</label>
                                <div class="file-upload-section" style="grid-template-columns: 1fr;">
                                    <div class="file-upload-item" id="completionAfterPhotoDropZone">
                                        <label for="completionAfterPhoto" class="file-upload-label">
                                            <span class="file-upload-icon">üì∑</span>
                                            <span>Upload After Photo</span>
                                            <span style="display: block; margin-top: 8px; font-size: 12px; color: #666;">or drag and drop files here</span>
                                        </label>
                                        <input type="file" id="completionAfterPhoto" accept="image/*" style="display: none;">
                                        <div id="completionAfterPhotoPreview" class="file-preview"></div>
                                        <button type="button" class="btn-remove-file" id="removeCompletionAfterPhoto" style="display: none;">Remove</button>
                                    </div>
                                </div>
                                <small style="color: #666; font-size: 12px;">Upload a photo showing the completed work</small>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn-primary" id="workflowSubmitBtn">Advance Workflow</button>
                                <button type="button" class="btn-secondary" id="cancelCompletionForm">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <!-- Metrics Dashboard -->
            <div class="metrics-dashboard">
                <div class="metrics-header">
                    <h2>üìä Metrics Dashboard</h2>
                    <button id="toggleMetricsBtn" class="btn-secondary btn-small">
                        <span id="metricsToggleText">Click to Expand</span>
                        <span id="metricsToggleIcon">‚ñº</span>
                    </button>
                </div>
                <div class="metrics-content" id="metricsContent" style="display: none;">
                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-label">Active Tickets</div>
                            <div class="metric-value" id="metricActiveTickets">0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Completed Tickets</div>
                            <div class="metric-value" id="metricCompletedTickets">0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Total Hours Allocated</div>
                            <div class="metric-value" id="metricTotalHours">0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Completed Hours</div>
                            <div class="metric-value" id="metricCompletedHours">0</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Estimated Cost (Active)</div>
                            <div class="metric-value" id="metricEstimatedCost">$0.00</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-label">Total Cost (Completed)</div>
                            <div class="metric-value" id="metricTotalCost">$0.00</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard -->
            <div class="dashboard">
                <div class="dashboard-header">
                    <button id="createTicketBtn" class="btn-primary btn-large">+ Create New Ticket</button>
                    <div class="view-toggle">
                        <button id="viewActiveBtn" class="btn-toggle active">Active Tickets</button>
                        <button id="viewMonitoringBtn" class="btn-toggle">Monitoring</button>
                        <button id="viewCompletedBtn" class="btn-toggle">Completed Tickets</button>
                        <button id="viewDeletedBtn" class="btn-toggle">Deleted Tickets</button>
                    </div>
                </div>

                <div id="activeTicketsView" class="tickets-view">
                    <h2>Active Tickets</h2>
                    <div id="activeTicketsList" class="tickets-list"></div>
                </div>

                <div id="monitoringTicketsView" class="tickets-view" style="display: none;">
                    <h2>Monitoring</h2>
                    <p style="color: #6B7280; margin-bottom: 20px; font-size: 14px;">Tickets that don't require immediate action but are being monitored. These may contain invoices or proposals for future work.</p>
                    <div id="monitoringTicketsList" class="tickets-list"></div>
                </div>

                <div id="completedTicketsView" class="tickets-view" style="display: none;">
                    <h2>Completed Tickets</h2>
                    <div id="completedTicketsList" class="tickets-list"></div>
                </div>
                <div id="deletedTicketsView" class="tickets-view" style="display: none;">
                    <h2>Deleted Tickets</h2>
                    <p style="color: #666; margin-bottom: 15px;">Tickets in this section will be permanently removed after 30 days.</p>
                    <div id="deletedTicketsList" class="tickets-list"></div>
                </div>
            </div>
            </main>
        </div>

        <!-- Properties Page -->
        <div id="propertiesPage" class="page" style="display: none;">
            <header>
                <h2>Properties</h2>
                <div class="header-actions">
                    <button id="addPropertyBtn" class="btn-primary">+ Add Property</button>
                </div>
            </header>

            <main>
                <div class="properties-page-content">
                    <!-- Property List -->
                    <div class="section">
                        <h3>Properties</h3>
                        <div id="propertiesList" class="properties-grid"></div>
                    </div>

                    <!-- Property Form (Modal) -->
                    <div id="propertyModal" class="modal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h2>Manage Property</h2>
                                <button class="close-btn" id="closePropertyModal">&times;</button>
                            </div>
                            <div class="modal-body">
                                <form id="propertyForm" style="display: none;">
                                    <input type="hidden" id="propertyId">
                                    <div class="form-group">
                                        <label for="propertyName">Property Name *</label>
                                        <input type="text" id="propertyName" required placeholder="e.g., Oakwood Apartments">
                                    </div>
                                    <div class="form-group">
                                        <label for="propertyAddress">Address</label>
                                        <input type="text" id="propertyAddress" placeholder="e.g., 123 Main St, City, State">
                                    </div>
                                    <div class="form-group">
                                        <label for="propertyType">Property Type *</label>
                                        <select id="propertyType" required>
                                            <option value="">Select property type...</option>
                                            <option value="commercial">Commercial</option>
                                            <option value="hoa">HOA</option>
                                            <option value="residential">Residential</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="propertyStatus">Property Status *</label>
                                        <select id="propertyStatus" required>
                                            <option value="Active">Active</option>
                                            <option value="Inactive">Inactive</option>
                                            <option value="Under Development">Under Development</option>
                                        </select>
                                    </div>
                            <div class="form-group" id="propertySquareFootageGroup">
                                <label for="propertySquareFootage">Square Footage <span id="squareFootageRequired">*</span></label>
                                <input type="number" id="propertySquareFootage" min="0" step="1" placeholder="e.g., 5000">
                            </div>
                            <div class="form-group" id="propertyYearBuiltGroup">
                                <label for="propertyYearBuilt">Year Built <span id="yearBuiltRequired">*</span></label>
                                <input type="number" id="propertyYearBuilt" min="1800" max="2100" step="1" placeholder="e.g., 2020">
                            </div>
                            <div class="form-group">
                                <label for="propertyNumberOfUnits">Number of Units/Spaces *</label>
                                <input type="number" id="propertyNumberOfUnits" min="0" step="1" required placeholder="e.g., 10">
                            </div>
                                    <div class="form-group">
                                        <label for="propertyLotSize">Lot Size</label>
                                        <input type="number" id="propertyLotSize" min="0" step="0.01" placeholder="e.g., 0.5 (acres)">
                                        <small style="color: #666; font-size: 12px;">Optional: Enter in acres or square feet</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="propertyNumberOfFloors">Number of Floors/Stories</label>
                                        <input type="number" id="propertyNumberOfFloors" min="1" step="1" placeholder="e.g., 3">
                                    </div>
                                    <div class="form-group">
                                        <label for="propertyParkingSpaces">Parking Spaces</label>
                                        <input type="number" id="propertyParkingSpaces" min="0" step="1" placeholder="e.g., 20">
                                    </div>
                                    <div class="form-group">
                                        <label for="propertyTaxId">Property Tax ID / Assessor Parcel Number</label>
                                        <input type="text" id="propertyTaxId" placeholder="e.g., 123-456-789">
                                    </div>
                                    <div class="form-group">
                                        <label for="propertyOwnerName">Property Owner Name</label>
                                        <input type="text" id="propertyOwnerName" placeholder="e.g., ABC Properties LLC">
                                    </div>
                                    <div class="form-group">
                                        <label for="propertyOwnerContact">Property Owner Contact</label>
                                        <input type="text" id="propertyOwnerContact" placeholder="e.g., owner@example.com or phone number">
                                    </div>
                                    <!-- Commercial Specific Fields -->
                                    <div id="commercialPropertyFields" style="display: none;">
                                        <div class="form-group">
                                            <label for="propertyBuildingNumber">Building Number</label>
                                            <input type="text" id="propertyBuildingNumber" placeholder="e.g., Building A">
                                        </div>
                                        <div class="form-group">
                                            <label for="propertyNumberOfBuildings">Number of Buildings</label>
                                            <input type="number" id="propertyNumberOfBuildings" min="1" step="1" placeholder="e.g., 3">
                                        </div>
                                        <div class="form-group">
                                            <label for="propertyTotalLeasableSqFt">Total Leasable Square Footage</label>
                                            <input type="number" id="propertyTotalLeasableSqFt" min="0" step="1" placeholder="e.g., 45000">
                                        </div>
                                        <div class="form-group">
                                            <label for="propertyCommonAreaSqFt">Common Area Square Footage</label>
                                            <input type="number" id="propertyCommonAreaSqFt" min="0" step="1" placeholder="e.g., 5000">
                                        </div>
                                    </div>
                                    <!-- Residential Specific Fields -->
                                    <div id="residentialPropertyFields" style="display: none;">
                                        <div class="form-group">
                                            <label for="propertyNumberOfBedrooms">Number of Bedrooms</label>
                                            <input type="number" id="propertyNumberOfBedrooms" min="0" step="1" placeholder="e.g., 3">
                                            <small style="color: #666; font-size: 12px;">For single-family properties</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="propertyNumberOfBathrooms">Number of Bathrooms</label>
                                            <input type="number" id="propertyNumberOfBathrooms" min="0" step="0.5" placeholder="e.g., 2.5">
                                            <small style="color: #666; font-size: 12px;">For single-family properties</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="propertySubtype">Property Subtype</label>
                                            <select id="propertySubtype">
                                                <option value="">Select subtype...</option>
                                                <option value="Single-Family">Single-Family</option>
                                                <option value="Multi-Family">Multi-Family</option>
                                                <option value="Apartment Complex">Apartment Complex</option>
                                                <option value="Condo">Condo</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="propertyDescription">Description</label>
                                        <textarea id="propertyDescription" rows="3" placeholder="Optional description or notes"></textarea>
                                    </div>
                                    <div class="form-actions">
                                        <button type="submit" class="btn-primary">Save Property</button>
                                        <button type="button" class="btn-secondary" id="cancelPropertyForm">Cancel</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Property Detail View (for buildings and units) -->
                    <div id="propertyDetailView" style="display: none;">
                        <div class="property-detail-header">
                            <button id="backToPropertiesBtn" class="btn-secondary">‚Üê Back to Properties</button>
                            <h3 id="propertyDetailName"></h3>
                        </div>
                        <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h4>Buildings & Units</h4>
                            <div style="display: flex; gap: 10px; display: none;">
                                <button id="addBuildingBtn" class="btn-primary btn-small">+ Add Building</button>
                                <button id="addUnitBtn" class="btn-primary btn-small">+ Add Unit</button>
                            </div>
                        </div>
                        <div id="buildingsUnitsTable" class="buildings-units-table-container" style="overflow-x: auto;"></div>
                        
                        <!-- Building Modal -->
                        <div id="buildingModal" class="modal">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h2 id="buildingModalTitle">Add Building</h2>
                                    <button class="close-btn" id="closeBuildingModal">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <form id="buildingForm">
                                        <input type="hidden" id="buildingId">
                                        <input type="hidden" id="buildingPropertyId">
                                        <div class="form-group">
                                            <label for="buildingName">Building Name/Number *</label>
                                            <input type="text" id="buildingName" required placeholder="e.g., Building A, Building 1">
                                        </div>
                                        <div class="form-group">
                                            <label for="buildingAddress">Building Address</label>
                                            <input type="text" id="buildingAddress" placeholder="e.g., 123 Main St, City, State (optional - defaults to property address)">
                                            <small style="color: #666; font-size: 12px;">Leave blank to use property address</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="buildingNumberOfFloors">Number of Floors</label>
                                            <input type="number" id="buildingNumberOfFloors" min="1" step="1" placeholder="e.g., 5">
                                        </div>
                                        <div class="form-group">
                                            <label for="buildingNumberOfUnits">Number of Units</label>
                                            <input type="number" id="buildingNumberOfUnits" min="0" step="1" placeholder="e.g., 20">
                                        </div>
                                        <div class="form-actions">
                                            <button type="submit" class="btn-primary">Save Building</button>
                                            <button type="button" class="btn-secondary" id="cancelBuildingForm">Cancel</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Unit Modal -->
                        <div id="unitModal" class="modal">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h2 id="unitModalTitle">Add Unit/Space</h2>
                                    <button class="close-btn" id="closeUnitModal">&times;</button>
                                </div>
                                <div class="modal-body">
                                    <form id="unitForm">
                                        <input type="hidden" id="unitId">
                                        <input type="hidden" id="unitPropertyId">
                                        <div class="form-group">
                                            <label for="unitNumber">Unit Number/Identifier *</label>
                                            <input type="text" id="unitNumber" required placeholder="e.g., 101, Suite A, Unit 1A">
                                        </div>
                                        <div class="form-group">
                                            <label for="unitType">Unit Type *</label>
                                            <select id="unitType" required>
                                                <option value="">Select unit type...</option>
                                                <option value="Apartment">Apartment</option>
                                                <option value="Office">Office</option>
                                                <option value="Retail">Retail</option>
                                                <option value="Storage">Storage</option>
                                                <option value="Parking">Parking</option>
                                                <option value="Other">Other</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="unitBuildingId">Building (Optional)</label>
                                            <select id="unitBuildingId">
                                                <option value="">No Building (Property Level)</option>
                                            </select>
                                            <small style="color: #666; font-size: 12px;">Select a building if this unit belongs to a specific building</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="unitSquareFootage">Square Footage</label>
                                            <input type="number" id="unitSquareFootage" min="0" step="1" placeholder="e.g., 800">
                                        </div>
                                        <div class="form-group">
                                            <label for="unitFloorNumber">Floor Number</label>
                                            <input type="number" id="unitFloorNumber" min="0" step="1" placeholder="e.g., 2">
                                        </div>
                                        <div class="form-group">
                                            <label for="unitNumberOfBedrooms">Number of Bedrooms</label>
                                            <input type="number" id="unitNumberOfBedrooms" min="0" step="1" placeholder="e.g., 2">
                                            <small style="color: #666; font-size: 12px;">For residential units</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="unitNumberOfBathrooms">Number of Bathrooms</label>
                                            <input type="number" id="unitNumberOfBathrooms" min="0" step="0.5" placeholder="e.g., 1.5">
                                            <small style="color: #666; font-size: 12px;">For residential units</small>
                                        </div>
                                        <div class="form-group">
                                            <label for="unitStatus">Unit Status *</label>
                                            <select id="unitStatus" required>
                                                <option value="Vacant">Vacant</option>
                                                <option value="Occupied">Occupied</option>
                                                <option value="Maintenance">Maintenance</option>
                                                <option value="Reserved">Reserved</option>
                                                <option value="Not Available">Not Available</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="unitMonthlyRent">Monthly Rent/Base Rate</label>
                                            <input type="number" id="unitMonthlyRent" min="0" step="0.01" placeholder="e.g., 1500.00">
                                            <small style="color: #666; font-size: 12px;">For quick reference</small>
                                        </div>
                                        <div class="form-actions">
                                            <button type="submit" class="btn-primary">Save Unit</button>
                                            <button type="button" class="btn-secondary" id="cancelUnitForm">Cancel</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Tenants Page -->
        <div id="tenantsPage" class="page" style="display: none;">
            <header>
                <h2>Tenant Management</h2>
                <div class="header-actions" style="display: none;">
                    <button id="addTenantBtn" class="btn-primary">+ Add Tenant</button>
                </div>
            </header>

            <main>
                <div class="tenants-page-content">
                    <div class="section">
                        <div class="section-header-controls">
                            <div class="filter-controls">
                                <label for="tenantPropertyFilter">Filter by Property:</label>
                                <select id="tenantPropertyFilter">
                                    <option value="">All Properties</option>
                                </select>
                            </div>
                            <div class="table-view-options" id="tableViewOptions" style="display: flex;">
                                <!-- All contacts are shown by default, no filter needed -->
                            </div>
                        </div>
                        <div id="tenantsList" class="tenants-grid" style="display: none;"></div>
                        <div id="tenantsTable" class="tenants-table-container"></div>
                    </div>
                </div>
            </main>
            
            <!-- Tenant Modal -->
            <div id="tenantModal" class="modal">
                <div class="modal-content" style="max-width: 800px;">
                    <div class="modal-header">
                        <h2 id="tenantModalTitle">Add Tenant</h2>
                        <button class="close-btn" id="closeTenantModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="tenantForm">
                            <input type="hidden" id="tenantId">
                            
                            <!-- Basic Information -->
                            <h3 style="margin: 20px 0 15px 0; color: #667eea; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">Basic Information</h3>
                            
                            <div class="form-group">
                                <label for="tenantName">Tenant Name *</label>
                                <input type="text" id="tenantName" required placeholder="e.g., John Smith, ABC Company">
                            </div>
                            
                            <div class="form-group">
                                <label for="tenantType">Tenant Type *</label>
                                <select id="tenantType" required>
                                    <option value="">Select tenant type...</option>
                                    <option value="Commercial">Commercial</option>
                                    <option value="Residential">Residential</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="tenantStatus">Status *</label>
                                <select id="tenantStatus" required>
                                    <option value="Active">Active</option>
                                    <option value="Past">Past</option>
                                    <option value="Moved Out">Moved Out</option>
                                    <option value="Prospect">Prospect</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="tenantPropertyId">Associated Property (Optional)</label>
                                <select id="tenantPropertyId">
                                    <option value="">No Property (Orphan Tenant)</option>
                                </select>
                                <small style="color: #666; font-size: 12px;">Associate tenant with a property to filter them by property. Leave blank for orphan tenants.</small>
                            </div>
                            
                            <!-- Unit Assignment Section (shown only when editing) -->
                            <div id="tenantUnitAssignmentSection" style="display: none;">
                                <h3 style="margin: 20px 0 15px 0; color: #2563EB; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">Unit Assignment</h3>
                                
                                <div class="form-group">
                                    <label for="tenantEditPropertyId">Property</label>
                                    <select id="tenantEditPropertyId">
                                        <option value="">Select property...</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="tenantEditUnitId">Unit/Space (Optional)</label>
                                    <select id="tenantEditUnitId">
                                        <option value="">No Unit (Property Level)</option>
                                    </select>
                                    <small style="color: #666; font-size: 12px;">Select a unit to assign this tenant to</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="tenantEditMoveInDate">Move-In Date</label>
                                    <input type="date" id="tenantEditMoveInDate">
                                </div>
                                
                                <div class="form-group">
                                    <label for="tenantEditMoveOutDate">Move-Out Date</label>
                                    <input type="date" id="tenantEditMoveOutDate">
                                    <small style="color: #666; font-size: 12px;">Leave blank if currently occupied</small>
                                </div>
                                
                                <div class="form-group">
                                    <label for="tenantEditOccupancyStatus">Occupancy Status</label>
                                    <select id="tenantEditOccupancyStatus">
                                        <option value="Active">Active</option>
                                        <option value="Past">Past</option>
                                        <option value="Pending">Pending</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="tenantEditOccupancyNotes">Occupancy Notes</label>
                                    <textarea id="tenantEditOccupancyNotes" rows="2" placeholder="Additional notes about this occupancy..."></textarea>
                                </div>
                                
                                <div class="form-actions" style="margin-top: 10px;">
                                    <button type="button" id="saveTenantOccupancyBtn" class="btn-primary btn-small">Save Unit Assignment</button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="tenantMailingAddress">Mailing Address</label>
                                <input type="text" id="tenantMailingAddress" placeholder="e.g., 123 Main St, City, State ZIP">
                            </div>
                            
                            <!-- Commercial Specific Fields -->
                            <div id="commercialTenantFields" style="display: none;">
                                <h3 style="margin: 20px 0 15px 0; color: #667eea; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">Commercial Information</h3>
                                
                                <div class="form-group">
                                    <label for="tenantTaxId">Tax ID / EIN</label>
                                    <input type="text" id="tenantTaxId" placeholder="e.g., 12-3456789">
                                </div>
                                
                                <div class="form-group">
                                    <label for="tenantBusinessType">Business Type</label>
                                    <input type="text" id="tenantBusinessType" placeholder="e.g., Retail, Office, Restaurant">
                                </div>
                                
                                <div class="form-group">
                                    <label for="tenantNumberOfEmployees">Number of Employees</label>
                                    <input type="number" id="tenantNumberOfEmployees" min="0" step="1" placeholder="e.g., 25">
                                </div>
                                
                                <div class="form-group">
                                    <label for="tenantWebsite">Website</label>
                                    <input type="url" id="tenantWebsite" placeholder="e.g., https://example.com">
                                </div>
                            </div>
                            
                            <!-- Residential Specific Fields -->
                            <div id="residentialTenantFields" style="display: none;">
                                <h3 style="margin: 20px 0 15px 0; color: #667eea; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">Residential Information</h3>
                                
                                <div class="form-group">
                                    <label for="tenantDateOfBirth">Date of Birth</label>
                                    <input type="date" id="tenantDateOfBirth">
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="tenantNotes">Notes</label>
                                <textarea id="tenantNotes" rows="3" placeholder="Additional notes about the tenant..."></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn-primary">Save Tenant</button>
                                <button type="button" class="btn-secondary" id="cancelTenantForm">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Tenant Detail Modal -->
            <div id="tenantDetailModal" class="modal">
                <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
                    <div class="modal-header">
                        <h2 id="tenantDetailName">Tenant Details</h2>
                        <button class="close-btn" id="closeTenantDetailModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="property-detail-tabs" style="margin-bottom: 20px; border-bottom: 2px solid #e2e8f0;">
                            <button class="tab-btn active" data-tab="contacts">Contacts</button>
                            <button class="tab-btn" data-tab="occupancies">Occupancies</button>
                        </div>
                        <div id="contactsTab" class="tab-content active">
                            <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 style="margin: 0;">Contacts</h4>
                                <button id="addContactBtn" class="btn-primary btn-small" style="display: none;">+ Add Contact</button>
                            </div>
                            <div id="contactsList" class="contacts-list"></div>
                        </div>
                        <div id="occupanciesTab" class="tab-content" style="display: none;">
                            <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 style="margin: 0;">Occupancies</h4>
                                <button id="addOccupancyBtn" class="btn-primary btn-small">+ Add Occupancy</button>
                            </div>
                            <div id="occupanciesList" class="occupancies-list"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Send Email Modal -->
            <div id="sendEmailModal" class="modal">
                <div class="modal-content" style="max-width: 700px;">
                    <div class="modal-header">
                        <h2>Send Email</h2>
                        <button class="close-btn" id="closeSendEmailModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label>Select Recipients:</label>
                            <div style="display: flex; flex-direction: column; gap: 15px; margin-top: 10px;">
                                <div>
                                    <label style="font-weight: 600; margin-bottom: 8px; display: block;">Buildings:</label>
                                    <div id="buildingCheckboxes" style="max-height: 150px; overflow-y: auto; border: 1px solid #e0e0e0; padding: 10px; border-radius: 4px;">
                                        <p style="color: #999; font-style: italic;">Loading buildings...</p>
                                    </div>
                                </div>
                                <div>
                                    <label style="font-weight: 600; margin-bottom: 8px; display: block;">Tenants:</label>
                                    <div id="tenantCheckboxes" style="max-height: 200px; overflow-y: auto; border: 1px solid #e0e0e0; padding: 10px; border-radius: 4px;">
                                        <p style="color: #999; font-style: italic;">Loading tenants...</p>
                                    </div>
                                </div>
                                <div>
                                    <label style="font-weight: 600; margin-bottom: 8px; display: block;">Individual Contacts:</label>
                                    <div id="contactCheckboxes" style="max-height: 200px; overflow-y: auto; border: 1px solid #e0e0e0; padding: 10px; border-radius: 4px;">
                                        <p style="color: #999; font-style: italic;">Loading contacts...</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e0e0e0;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <strong>Selected Recipients:</strong> <span id="selectedRecipientsCount">0</span>
                                </div>
                                <button type="button" class="btn-primary" id="openEmailClientBtn">Open Email Client</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Contact Modal -->
            <div id="contactModal" class="modal">
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h2 id="contactModalTitle">Add Contact</h2>
                        <button class="close-btn" id="closeContactModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="contactForm">
                            <input type="hidden" id="contactId">
                            
                            <div class="form-group">
                                <label for="contactTenantIdSelect">Tenant (Optional)</label>
                                <select id="contactTenantIdSelect">
                                    <option value="">No Tenant (Orphan Contact)</option>
                                </select>
                                <small style="color: #666; font-size: 12px;">Leave blank to create an orphan contact</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="contactPropertyId">Associated Property (Optional)</label>
                                <select id="contactPropertyId">
                                    <option value="">No Property (Orphan Contact)</option>
                                </select>
                                <small style="color: #666; font-size: 12px;">Associate contact with a property to filter them by property. Leave blank for orphan contacts.</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="contactName">Contact Name *</label>
                                <input type="text" id="contactName" required placeholder="e.g., John Doe">
                            </div>
                            
                            <div class="form-group">
                                <label for="contactEmail">Email</label>
                                <input type="email" id="contactEmail" placeholder="e.g., john@example.com">
                            </div>
                            
                            <div class="form-group">
                                <label for="contactPhone">Phone</label>
                                <input type="tel" id="contactPhone" placeholder="e.g., (555) 123-4567">
                            </div>
                            
                            <div class="form-group">
                                <label for="contactTitle">Title/Position</label>
                                <input type="text" id="contactTitle" placeholder="e.g., Property Manager, CEO">
                            </div>
                            
                            <div class="form-group">
                                <label>Contact Classifications *</label>
                                <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 10px;">
                                    <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                                        <input type="checkbox" id="contactPrimary" value="Primary">
                                        <span>Primary Contact</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                                        <input type="checkbox" id="contactSecondary" value="Secondary">
                                        <span>Secondary Contact</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                                        <input type="checkbox" id="contactLeasing" value="Leasing">
                                        <span>Leasing Contact</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                                        <input type="checkbox" id="contactBilling" value="Billing">
                                        <span>Billing Contact</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
                                        <input type="checkbox" id="contactTenantRepresentative" value="Tenant Representative">
                                        <span>Tenant Representative</span>
                                    </label>
                                </div>
                                <small style="color: #666; font-size: 12px;">Select one or more classifications</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="contactNotes">Notes</label>
                                <textarea id="contactNotes" rows="2" placeholder="Additional notes about this contact..."></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn-primary">Save Contact</button>
                                <button type="button" class="btn-secondary" id="cancelContactForm">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Occupancy Modal -->
            <div id="occupancyModal" class="modal">
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h2 id="occupancyModalTitle">Add Occupancy</h2>
                        <button class="close-btn" id="closeOccupancyModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="occupancyForm">
                            <input type="hidden" id="occupancyId">
                            <input type="hidden" id="occupancyTenantId">
                            
                            <div class="form-group">
                                <label for="occupancyPropertyId">Property *</label>
                                <select id="occupancyPropertyId" required>
                                    <option value="">Select property...</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="occupancyUnitId">Unit/Space (Optional)</label>
                                <select id="occupancyUnitId">
                                    <option value="">No Unit (Property Level)</option>
                                </select>
                                <small style="color: #666; font-size: 12px;">Select a unit if this occupancy is for a specific unit</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="occupancyMoveInDate">Move-In Date *</label>
                                <input type="date" id="occupancyMoveInDate" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="occupancyMoveOutDate">Move-Out Date</label>
                                <input type="date" id="occupancyMoveOutDate">
                                <small style="color: #666; font-size: 12px;">Leave blank if currently occupied</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="occupancyStatus">Status *</label>
                                <select id="occupancyStatus" required>
                                    <option value="Active">Active</option>
                                    <option value="Past">Past</option>
                                    <option value="Pending">Pending</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="occupancyNotes">Notes</label>
                                <textarea id="occupancyNotes" rows="2" placeholder="Additional notes about this occupancy..."></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="submit" class="btn-primary">Save Occupancy</button>
                                <button type="button" class="btn-secondary" id="cancelOccupancyForm">Cancel</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <!-- Leases Page -->
        <div id="leasesPage" class="page" style="display: none;">
            <header>
                <h2>Lease Management</h2>
            </header>

            <main>
                <div class="leases-page-content">
                    <div class="section">
                        <div class="section-header-controls">
                            <div class="filter-controls" style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px;">
                                <div>
                                    <label for="leasePropertyFilter">Filter by Property:</label>
                                    <select id="leasePropertyFilter">
                                        <option value="">All Properties</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div id="leasesList" style="display: none;"></div>
                        <div id="leasesTable" class="leases-table-container"></div>
                    </div>
                </div>
            </main>
            
            <!-- Unit Lease Detail Modal -->
            <div id="unitLeaseDetailModal" class="modal">
                <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
                    <div class="modal-header">
                        <h2 id="unitLeaseDetailTitle">Unit Leases</h2>
                        <button class="close-btn" id="closeUnitLeaseDetailModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="property-detail-tabs" style="margin-bottom: 20px; border-bottom: 2px solid #e2e8f0;">
                            <button class="tab-btn active" data-tab="activeLeases">Active Leases</button>
                            <button class="tab-btn" data-tab="legacyLeases">Legacy Leases</button>
                            <button class="tab-btn" data-tab="deletedLeases">Deleted Leases</button>
                        </div>
                        <div id="activeLeasesTab" class="tab-content active">
                            <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 style="margin: 0;">Active Leases</h4>
                                <button id="addLeaseFromUnitBtn" class="btn-primary btn-small">+ Add Lease</button>
                            </div>
                            <div id="activeLeasesList" class="leases-list"></div>
                        </div>
                        <div id="legacyLeasesTab" class="tab-content" style="display: none;">
                            <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 style="margin: 0;">Legacy Leases</h4>
                            </div>
                            <div id="legacyLeasesList" class="leases-list"></div>
                        </div>
                        <div id="deletedLeasesTab" class="tab-content" style="display: none;">
                            <div class="section-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <h4 style="margin: 0;">Deleted Leases</h4>
                                <small style="color: #666;">Leases will be permanently removed after 30 days</small>
                            </div>
                            <div id="deletedLeasesList" class="leases-list"></div>
                        </div>
                    </div>
            </div>
        </div>
        
        <!-- Deprecated Lease Modal -->
        <div id="deprecatedLeaseModal" class="modal">
            <div class="modal-content" style="max-width: 500px;">
                <div class="modal-header">
                    <h2>Mark Lease as Deprecated/Legacy</h2>
                    <button class="modal-close" onclick="closeDeprecatedModal()">&times;</button>
                </div>
                <form id="deprecatedLeaseForm" style="padding: 0 30px 30px 30px;">
                    <input type="hidden" id="deprecatedLeaseId">
                    <div class="form-group">
                        <label for="deprecatedLeaseDate">Deprecated/Legacy Date *</label>
                        <input type="date" id="deprecatedLeaseDate" required>
                        <small style="color: #666; display: block; margin-top: 5px;">Date when this lease was marked as deprecated/legacy</small>
                    </div>
                    <div class="form-group">
                        <label for="deprecatedReason">Deprecation Reason</label>
                        <textarea id="deprecatedReason" rows="4" placeholder="Enter reason for marking this lease as deprecated/legacy (optional)"></textarea>
                        <small style="color: #666; display: block; margin-top: 5px;">Optional: Provide context for why this lease is being marked as deprecated</small>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn-secondary" onclick="closeDeprecatedModal()">Cancel</button>
                        <button type="submit" class="btn-danger">Mark as Deprecated</button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Lease Modal -->
        <div id="leaseModal" class="modal">
                <div class="modal-content" style="max-width: 900px;">
                    <div class="modal-header">
                        <h2 id="leaseModalTitle">Add Lease</h2>
                        <button class="close-btn" id="closeLeaseModal">&times;</button>
                    </div>
                    <div class="modal-body">
                        <form id="leaseForm">
                            <input type="hidden" id="leaseId">
                            
                            <!-- Basic Information -->
                            <h3 style="margin: 20px 0 15px 0; color: #667eea; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">Basic Information</h3>
                            
                            <div class="form-group">
                                <label for="leaseNumber">Lease Number</label>
                                <input type="text" id="leaseNumber" placeholder="Auto-generated or manual">
                            </div>
                            
                            <div class="form-group">
                                <label for="leaseTenantId">Tenant *</label>
                                <select id="leaseTenantId" required>
                                    <option value="">Select tenant...</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="leasePropertyId">Property *</label>
                                <select id="leasePropertyId" required>
                                    <option value="">Select property...</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="leaseUnitId">Unit/Space (Optional)</label>
                                <select id="leaseUnitId">
                                    <option value="">No Unit (Property Level)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="leaseType">Lease Type *</label>
                                <select id="leaseType" required>
                                    <option value="">Select type...</option>
                                    <option value="Commercial">Commercial</option>
                                    <option value="Residential">Residential</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="leaseStatus">Status *</label>
                                <select id="leaseStatus" required>
                                    <option value="Active">Active</option>
                                    <option value="Expiring Soon">Expiring Soon</option>
                                    <option value="Expired">Expired</option>
                                    <option value="Terminated">Terminated</option>
                                    <option value="Renewed">Renewed</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                                    <span style="font-weight: 600; color: #555;">Mark as Deprecated/Legacy</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="isDeprecated">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                                <small style="color: #666; display: block; margin-top: 5px;">Mark this lease as deprecated or legacy for archival purposes</small>
                            </div>
                            
                            <div class="form-group" id="deprecatedDateGroup" style="display: none;">
                                <label for="deprecatedDate">Deprecated/Legacy Date</label>
                                <input type="date" id="deprecatedDate">
                                <small style="color: #666; display: block; margin-top: 5px;">Date when this lease was marked as deprecated/legacy</small>
                            </div>
                            
                            <div class="form-group" id="deprecatedReasonGroup" style="display: none;">
                                <label for="deprecatedReasonInForm">Deprecation Reason</label>
                                <textarea id="deprecatedReasonInForm" rows="3" placeholder="Enter reason for marking this lease as deprecated/legacy (optional)"></textarea>
                                <small style="color: #666; display: block; margin-top: 5px;">Optional: Provide context for why this lease is being marked as deprecated</small>
                            </div>
                            
                            <!-- Lease Dates -->
                            <h3 style="margin: 30px 0 15px 0; color: #667eea; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">Lease Dates</h3>
                            
                            <div class="form-group">
                                <label for="leaseStartDate">Lease Start Date *</label>
                                <input type="date" id="leaseStartDate" required>
                            </div>
                            
                            <div class="form-group">
                                <label>Lease Duration</label>
                                <div style="display: flex; gap: 15px; align-items: flex-end; flex-wrap: wrap;">
                                    <div style="flex: 1; min-width: 200px;">
                                        <label for="leaseEndDate" style="display: block; margin-bottom: 5px;">Lease End Date</label>
                                        <input type="date" id="leaseEndDate">
                                    </div>
                                    <div style="text-align: center; padding: 0 10px; color: #999;">OR</div>
                                    <div style="flex: 1; min-width: 200px;">
                                        <label for="leaseTermInput" style="display: block; margin-bottom: 5px;">Lease Term</label>
                                        <div style="display: flex; gap: 5px;">
                                            <input type="number" id="leaseTermInput" min="0" step="0.5" placeholder="0" style="flex: 1;">
                                            <select id="leaseTermUnit" style="width: 100px;">
                                                <option value="months">Months</option>
                                                <option value="years">Years</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <small style="color: #666; display: block; margin-top: 5px;">Enter either end date or term - the other will be calculated automatically</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="leaseTerm">Calculated Term (months)</label>
                                <input type="number" id="leaseTerm" readonly placeholder="Auto-calculated">
                            </div>
                            
                            <div class="form-group">
                                <label>
                                    <input type="checkbox" id="autoRenewal" style="margin-right: 8px;">
                                    Auto Renewal
                                </label>
                                <small style="color: #666; display: block; margin-top: 5px;">Lease will automatically renew at expiration</small>
                            </div>
                            
                            <div id="autoRenewalTermGroup" style="display: none;">
                                <div class="form-group">
                                    <label for="autoRenewalTerm">Auto Renewal Term</label>
                                    <div style="display: flex; gap: 5px;">
                                        <input type="number" id="autoRenewalTerm" min="1" step="0.5" placeholder="12" style="flex: 1;">
                                        <select id="autoRenewalTermUnit" style="width: 100px;">
                                            <option value="months">Months</option>
                                            <option value="years">Years</option>
                                        </select>
                                    </div>
                                    <small style="color: #666;">Term length for each auto renewal</small>
                                </div>
                            </div>
                            
                            <!-- Financial Information -->
                            <h3 style="margin: 30px 0 15px 0; color: #667eea; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">Financial Information</h3>
                            
                            <div class="form-group">
                                <label for="monthlyRent">Monthly Rent *</label>
                                <input type="number" id="monthlyRent" step="0.01" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="securityDeposit">Security Deposit *</label>
                                <input type="number" id="securityDeposit" step="0.01" required>
                            </div>
                            
                            <!-- Additional Monthly Charges -->
                            <div class="form-group" style="margin: 20px 0 10px 0;">
                                <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                                    <span style="font-weight: 600; color: #555;">Additional Monthly Charges</span>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="showAdditionalCharges">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                            </div>
                            
                            <div id="additionalChargesGroup" style="display: none;">
                                <div class="form-group">
                                    <label for="utilitiesCharge">Utilities</label>
                                    <input type="number" id="utilitiesCharge" step="0.01" placeholder="0.00">
                                </div>
                                
                                <div class="form-group">
                                    <label for="parkingCharge">Parking</label>
                                    <input type="number" id="parkingCharge" step="0.01" placeholder="0.00">
                                </div>
                                
                                <div class="form-group">
                                    <label for="petFeeCharge">Pet Fee</label>
                                    <input type="number" id="petFeeCharge" step="0.01" placeholder="0.00">
                                </div>
                                
                                <div class="form-group" id="camChargesGroup" style="display: none;">
                                    <label for="camCharges">CAM Charges (Commercial)</label>
                                    <input type="number" id="camCharges" step="0.01" placeholder="0.00">
                                </div>
                            </div>
                            
                            <!-- Commercial Leasing Features (Commercial Only) -->
                            <div id="commercialLeasingFeatures" style="display: none;">
                                <h3 style="margin: 30px 0 15px 0; color: #667eea; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">Commercial Leasing Features</h3>
                                
                                <!-- Rent Escalation -->
                                <h4 style="margin: 20px 0 10px 0; color: #666;">Rent Escalation</h4>
                                
                                <div class="form-group">
                                    <label for="escalationType">Escalation Type</label>
                                    <select id="escalationType">
                                        <option value="None">None</option>
                                        <option value="Fixed Amount">Fixed Amount</option>
                                        <option value="Percentage">Percentage</option>
                                        <option value="CPI">CPI (Consumer Price Index)</option>
                                    </select>
                                </div>
                                
                                <div class="form-group" id="escalationAmountGroup" style="display: none;">
                                    <label for="escalationAmount">Escalation Amount ($)</label>
                                    <input type="number" id="escalationAmount" step="0.01" placeholder="0.00">
                                    <small style="color: #666;">Fixed dollar amount increase per escalation period</small>
                                </div>
                                
                                <div class="form-group" id="escalationPercentageGroup" style="display: none;">
                                    <label for="escalationPercentage">Escalation Percentage (%)</label>
                                    <input type="number" id="escalationPercentage" step="0.01" placeholder="0.00" min="0" max="100">
                                    <small style="color: #666;">Percentage increase per escalation period</small>
                                </div>
                                
                                <div class="form-group" id="escalationFrequencyGroup" style="display: none;">
                                    <label for="escalationFrequency">Escalation Frequency</label>
                                    <select id="escalationFrequency">
                                        <option value="">Select frequency...</option>
                                        <option value="Monthly">Monthly</option>
                                        <option value="Quarterly">Quarterly</option>
                                        <option value="Annually">Annually</option>
                                    </select>
                                </div>
                                
                                <div class="form-group" id="firstEscalationDateGroup" style="display: none;">
                                    <label for="firstEscalationDate">First Escalation Date</label>
                                    <input type="date" id="firstEscalationDate">
                                    <small style="color: #666;">Date when first escalation takes effect</small>
                                </div>
                                
                                <!-- Extension/Options -->
                                <div class="form-group" style="margin: 30px 0 10px 0;">
                                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                                        <span style="font-weight: 600; color: #555;">Extension Options</span>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="hasExtensionOptions">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </label>
                                    <small style="color: #666; display: block; margin-top: 5px;">Lease has extension/renewal options</small>
                                </div>
                                
                                <div id="extensionOptionsGroup" style="display: none;">
                                    <div class="form-group">
                                        <label for="numberOfExtensions">Number of Extension Options</label>
                                        <input type="number" id="numberOfExtensions" min="0" placeholder="0">
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="extensionTermLength">Extension Term Length</label>
                                        <div style="display: flex; gap: 5px;">
                                            <input type="number" id="extensionTermLength" min="1" placeholder="12" style="flex: 1;">
                                            <select id="extensionTermUnit" style="width: 120px;">
                                                <option value="months">Months</option>
                                                <option value="years">Years</option>
                                            </select>
                                        </div>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="extensionNoticePeriod">Extension Notice Period</label>
                                        <div style="display: flex; gap: 5px;">
                                            <input type="number" id="extensionNoticePeriod" min="0" placeholder="90" style="flex: 1;">
                                            <select id="extensionNoticeUnit" style="width: 120px;">
                                                <option value="days">Days</option>
                                                <option value="months">Months</option>
                                            </select>
                                        </div>
                                        <small style="color: #666;">Time before lease end that tenant must provide notice</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="extensionRentType">Extension Rent Type</label>
                                        <select id="extensionRentType">
                                            <option value="">Select type...</option>
                                            <option value="Fair Market Value">Fair Market Value</option>
                                            <option value="Fixed Amount">Fixed Amount</option>
                                            <option value="Percentage Increase">Percentage Increase</option>
                                            <option value="Same as Current">Same as Current</option>
                                        </select>
                                    </div>
                                    
                                    <div class="form-group" id="extensionRentAmountGroup" style="display: none;">
                                        <label for="extensionRentAmount">Extension Rent Amount ($)</label>
                                        <input type="number" id="extensionRentAmount" step="0.01" placeholder="0.00">
                                    </div>
                                    
                                    <div class="form-group" id="extensionRentPercentageGroup" style="display: none;">
                                        <label for="extensionRentPercentage">Extension Rent Increase (%)</label>
                                        <input type="number" id="extensionRentPercentage" step="0.01" placeholder="0.00" min="0">
                                    </div>
                                </div>
                                
                                <!-- Additional Commercial Features -->
                                <div class="form-group" style="margin: 30px 0 10px 0;">
                                    <label style="display: flex; align-items: center; gap: 12px; cursor: pointer;">
                                        <span style="font-weight: 600; color: #555;">Additional Commercial Terms</span>
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="showCommercialTerms">
                                            <span class="toggle-slider"></span>
                                        </label>
                                    </label>
                                </div>
                                
                                <div id="commercialTermsGroup" style="display: none;">
                                    <div class="form-group">
                                        <label for="baseYear">Base Year for CAM/Operating Expenses</label>
                                        <input type="number" id="baseYear" placeholder="2024" min="2000" max="2100">
                                        <small style="color: #666;">Base year used for calculating CAM and operating expense increases</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="operatingExpenseCap">Operating Expense Cap (%)</label>
                                        <input type="number" id="operatingExpenseCap" step="0.01" placeholder="0.00" min="0" max="100">
                                        <small style="color: #666;">Maximum annual increase in operating expenses (as percentage)</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="rentAbatementMonths">Rent Abatement Period (months)</label>
                                        <input type="number" id="rentAbatementMonths" min="0" placeholder="0">
                                        <small style="color: #666;">Number of months of free/reduced rent at lease start</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="rentAbatementAmount">Rent Abatement Amount ($)</label>
                                        <input type="number" id="rentAbatementAmount" step="0.01" placeholder="0.00">
                                        <small style="color: #666;">Total amount of rent abatement/concession</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="tenantImprovementAllowance">Tenant Improvement Allowance ($)</label>
                                        <input type="number" id="tenantImprovementAllowance" step="0.01" placeholder="0.00">
                                        <small style="color: #666;">Total TI allowance provided to tenant</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="rightOfFirstRefusal" style="margin-right: 8px;">
                                            Right of First Refusal
                                        </label>
                                        <small style="color: #666; display: block; margin-top: 5px;">Tenant has right of first refusal on adjacent/expanding space</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="exclusiveUse" style="margin-right: 8px;">
                                            Exclusive Use Clause
                                        </label>
                                        <small style="color: #666; display: block; margin-top: 5px;">Tenant has exclusive use rights for specific business type</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="exclusiveUseDescription">Exclusive Use Description</label>
                                        <textarea id="exclusiveUseDescription" rows="2" placeholder="Describe the exclusive use rights..."></textarea>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="percentageRent">Percentage Rent Threshold ($)</label>
                                        <input type="number" id="percentageRent" step="0.01" placeholder="0.00">
                                        <small style="color: #666;">Sales threshold above which percentage rent applies (for retail)</small>
                                    </div>
                                    
                                    <div class="form-group">
                                        <label for="percentageRentRate">Percentage Rent Rate (%)</label>
                                        <input type="number" id="percentageRentRate" step="0.01" placeholder="0.00" min="0" max="100">
                                        <small style="color: #666;">Percentage of sales above threshold paid as rent</small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Special Terms & Notes -->
                            <h3 style="margin: 30px 0 15px 0; color: #667eea; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">Additional Information</h3>
                            
                            <div class="form-group">
                                <label for="specialTerms">Special Terms</label>
                                <textarea id="specialTerms" rows="4" placeholder="Any special terms or conditions..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="leaseNotes">Notes</label>
                                <textarea id="leaseNotes" rows="4" placeholder="Internal notes..."></textarea>
                            </div>
                            
                            <!-- Document Upload -->
                            <div class="form-group">
                                <label for="leaseDocument">Lease Document (PDF)</label>
                                <div id="leaseDocumentDropZone" style="border: 2px dashed #ccc; border-radius: 8px; padding: 30px; text-align: center; background-color: #f9f9f9; cursor: pointer; transition: all 0.3s ease; margin-top: 10px;">
                                    <div id="leaseDocumentDropZoneContent">
                                        <p style="margin: 0 0 10px 0; color: #666; font-size: 14px;">
                                            <strong>Drag and drop a PDF file here</strong>
                                        </p>
                                        <p style="margin: 0; color: #999; font-size: 12px;">or</p>
                                        <label for="leaseDocument" style="display: inline-block; margin-top: 10px; padding: 8px 16px; background-color: #667eea; color: white; border-radius: 4px; cursor: pointer; font-size: 14px;">
                                            Browse Files
                                        </label>
                                        <input type="file" id="leaseDocument" accept=".pdf" style="display: none;">
                                    </div>
                                    <div id="leaseDocumentFileName" style="display: none; margin-top: 10px; padding: 8px; background-color: #e8f4f8; border-radius: 4px;">
                                        <span id="leaseDocumentFileNameText" style="color: #667eea; font-weight: 500;"></span>
                                        <button type="button" id="leaseDocumentRemoveBtn" style="margin-left: 10px; padding: 4px 8px; background-color: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">Remove</button>
                                    </div>
                                </div>
                                <small style="color: #666; display: block; margin-top: 8px;">Upload the signed lease document (PDF only)</small>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn-secondary" id="cancelLeaseBtn">Cancel</button>
                                <button type="button" class="btn-secondary" id="editLeaseBtn" style="display: none;">Edit</button>
                                <button type="submit" class="btn-primary">Save Lease</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Finance Page -->
        <div id="financePage" class="page" style="display: none;">
            <header>
                <h2>Finance</h2>
            </header>

            <main>
                <div class="finance-page-content">
                    <!-- Finance Sub-tabs -->
                    <div class="finance-tabs" style="margin-bottom: 20px; border-bottom: 2px solid #e2e8f0;">
                        <button class="tab-btn active" data-finance-tab="rentRoll">Rent Roll</button>
                        <!-- Future tabs can be added here -->
                    </div>

                    <!-- Rent Roll Tab -->
                    <div id="rentRollTab" class="tab-content active">
                        <div class="section">
                            <div class="section-header-controls">
                                <div class="filter-controls" style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px;">
                                    <div>
                                        <label for="rentRollPropertyFilter">Filter by Property:</label>
                                        <select id="rentRollPropertyFilter">
                                            <option value="">All Properties</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="rentRollBuildingFilter">Filter by Building:</label>
                                        <select id="rentRollBuildingFilter">
                                            <option value="">All Buildings</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="rentRollTenantFilter">Filter by Tenant:</label>
                                        <select id="rentRollTenantFilter">
                                            <option value="">All Tenants</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="rentRollYearFilter">Year:</label>
                                        <select id="rentRollYearFilter">
                                            <option value="2025">2025</option>
                                            <option value="2026" selected>2026</option>
                                            <option value="2027">2027</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="view-options" style="display: flex; gap: 20px; flex-wrap: wrap; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                                    <div>
                                        <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b;">View Orientation:</label>
                                        <div style="display: flex; gap: 15px;">
                                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                                <input type="radio" name="rentRollOrientation" value="vertical" id="rentRollOrientationVertical" checked>
                                                <span>Vertical (Tenants ‚Üí X, Months ‚Üí Y)</span>
                                            </label>
                                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                                <input type="radio" name="rentRollOrientation" value="horizontal" id="rentRollOrientationHorizontal">
                                                <span>Horizontal (Tenants ‚Üí Y, Months ‚Üí X)</span>
                                            </label>
                                        </div>
                                    </div>
                                    <div>
                                        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                                            <input type="checkbox" id="rentRollBreakoutByBuilding">
                                            <span style="font-weight: 600; color: #1e293b;">Break out by Building</span>
                                        </label>
                                        <small style="display: block; color: #64748b; margin-top: 4px;">Group leases by building within each property</small>
                                    </div>
                                </div>
                            </div>
                            <div id="rentRollTable" class="rent-roll-container" style="overflow-x: auto;"></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Users Management Page -->
        <div id="usersPage" class="page" style="display: none;">
            <header>
                <h2>User Management</h2>
                <div class="header-actions">
                    <button id="inviteUserBtn" class="btn-primary">Invite User</button>
                </div>
            </header>

            <main>
                <!-- Filters and Search -->
                <div class="filters-section" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: end;">
                        <div style="flex: 1; min-width: 200px;">
                            <label for="userSearch" style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">Search</label>
                            <input type="text" id="userSearch" placeholder="Search by name or email..." style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                        </div>
                        <div style="min-width: 150px;">
                            <label for="userRoleFilter" style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">Role</label>
                            <select id="userRoleFilter" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                                <option value="">All Roles</option>
                                <option value="super_admin">Super Admin</option>
                                <option value="admin">Admin</option>
                                <option value="property_manager">Property Manager</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="viewer">Viewer</option>
                            </select>
                        </div>
                        <div style="min-width: 150px;">
                            <label for="userStatusFilter" style="display: block; margin-bottom: 8px; font-weight: 600; color: #555;">Status</label>
                            <select id="userStatusFilter" style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; font-size: 14px;">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="pending">Pending</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Users List -->
                <div id="usersList" class="users-list">
                    <div class="empty-state">
                        <div class="empty-state-icon">üë•</div>
                        <p>Loading users...</p>
                    </div>
                </div>
            </main>
        </div>

        <!-- User Detail/Edit Modal -->
        <div id="userDetailModal" class="modal">
            <div class="modal-content" style="max-width: 900px;">
                <div class="modal-header">
                    <h2 id="userDetailModalTitle">User Details</h2>
                    <button class="close-btn" id="closeUserDetailModal">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- Tabs -->
                    <div class="user-detail-tabs" style="display: flex; gap: 10px; border-bottom: 2px solid #e2e8f0; margin-bottom: 20px;">
                        <button class="tab-btn active" data-user-tab="details" style="padding: 10px 20px; border: none; background: none; cursor: pointer; font-weight: 600; color: #667eea; border-bottom: 2px solid #667eea; margin-bottom: -2px;">Details</button>
                        <button class="tab-btn" data-user-tab="properties" style="padding: 10px 20px; border: none; background: none; cursor: pointer; font-weight: 600; color: #666;">Properties</button>
                        <button class="tab-btn" data-user-tab="activity" style="padding: 10px 20px; border: none; background: none; cursor: pointer; font-weight: 600; color: #666;">Activity</button>
                    </div>

                    <!-- Details Tab -->
                    <div id="userDetailsTab" class="user-tab-content active">
                        <form id="userDetailForm">
                            <input type="hidden" id="userDetailId">
                            
                            <h3 style="margin: 20px 0 15px 0; color: #667eea; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">Basic Information</h3>
                            
                            <div class="form-group">
                                <label for="userDetailEmail">Email</label>
                                <input type="email" id="userDetailEmail" readonly style="background: #f5f5f5; cursor: not-allowed;">
                                <small style="color: #666; font-size: 12px;">Email cannot be changed</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="userDetailDisplayName">Full Name *</label>
                                <input type="text" id="userDetailDisplayName" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="userDetailPhone">Phone</label>
                                <input type="tel" id="userDetailPhone">
                            </div>
                            
                            <div class="form-group">
                                <label for="userDetailRole">Role *</label>
                                <select id="userDetailRole" required>
                                    <option value="">Select role...</option>
                                    <option value="super_admin">Super Admin</option>
                                    <option value="admin">Admin</option>
                                    <option value="property_manager">Property Manager</option>
                                    <option value="maintenance">Maintenance</option>
                                    <option value="viewer">Viewer</option>
                                </select>
                                <small style="color: #666; font-size: 12px;" id="userDetailRoleNote"></small>
                            </div>
                            
                            <div class="form-group">
                                <label for="userDetailStatus">Status</label>
                                <select id="userDetailStatus">
                                    <option value="true">Active</option>
                                    <option value="false">Inactive</option>
                                </select>
                            </div>
                            
                            <h3 style="margin: 30px 0 15px 0; color: #667eea; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">Additional Information</h3>
                            
                            <div class="form-group">
                                <label for="userDetailTitle">Title</label>
                                <input type="text" id="userDetailTitle" placeholder="e.g., Property Manager, Maintenance Lead">
                            </div>
                            
                            <div class="form-group">
                                <label for="userDetailDepartment">Department</label>
                                <input type="text" id="userDetailDepartment" placeholder="e.g., Operations, Maintenance">
                            </div>
                            
                            <div class="form-group">
                                <label for="userDetailNotes">Notes</label>
                                <textarea id="userDetailNotes" rows="3" placeholder="Additional notes about this user..."></textarea>
                            </div>
                            
                            <div class="form-group" style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-top: 20px;">
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span style="font-weight: 600; color: #333;">Created:</span>
                                    <span id="userDetailCreated" style="color: #666;">‚Äî</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="font-weight: 600; color: #333;">Last Login:</span>
                                    <span id="userDetailLastLogin" style="color: #666;">‚Äî</span>
                                </div>
                            </div>
                            
                            <div class="form-actions" style="margin-top: 25px;">
                                <button type="submit" class="btn-primary" id="saveUserBtn">Save Changes</button>
                                <button type="button" class="btn-secondary" id="cancelUserDetailForm">Cancel</button>
                            </div>
                        </form>
                    </div>

                    <!-- Properties Tab -->
                    <div id="userPropertiesTab" class="user-tab-content" style="display: none;">
                        <h3 style="margin: 0 0 20px 0; color: #667eea;">Assigned Properties</h3>
                        <div id="userPropertiesList" style="margin-bottom: 20px;">
                            <p style="color: #999; font-style: italic;">Loading properties...</p>
                        </div>
                        <div class="form-group">
                            <label for="userPropertySelector">Assign Properties</label>
                            <div id="userPropertyCheckboxes" style="max-height: 300px; overflow-y: auto; border: 1px solid #e0e0e0; padding: 15px; border-radius: 6px; background: #f8f9fa;">
                                <p style="color: #999; font-style: italic;">Loading properties...</p>
                            </div>
                            <small style="color: #666; font-size: 12px;">Select properties this user has access to. Super Admins and Admins have access to all properties.</small>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn-primary" id="saveUserPropertiesBtn">Save Property Assignments</button>
                        </div>
                    </div>

                    <!-- Activity Tab -->
                    <div id="userActivityTab" class="user-tab-content" style="display: none;">
                        <h3 style="margin: 0 0 20px 0; color: #667eea;">Activity Log</h3>
                        <div id="userActivityLog" style="min-height: 200px;">
                            <p style="color: #999; font-style: italic; text-align: center; padding: 40px;">Activity logging coming soon...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Invite User Modal -->
        <div id="inviteUserModal" class="modal">
            <div class="modal-content" style="max-width: 700px;">
                <div class="modal-header">
                    <h2>Invite User</h2>
                    <button class="close-btn" id="closeInviteUserModal">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="inviteUserForm">
                        <h3 style="margin: 0 0 20px 0; color: #667eea; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">User Information</h3>
                        
                        <div class="form-group">
                            <label for="inviteEmail">Email *</label>
                            <input type="email" id="inviteEmail" required autocomplete="email">
                        </div>
                        
                        <div class="form-group">
                            <label for="inviteFullName">Full Name *</label>
                            <input type="text" id="inviteFullName" required autocomplete="name">
                        </div>
                        
                        <div class="form-group">
                            <label for="invitePhone">Phone</label>
                            <input type="tel" id="invitePhone" autocomplete="tel">
                        </div>
                        
                        <h3 style="margin: 30px 0 20px 0; color: #667eea; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">Role & Permissions</h3>
                        
                        <div class="form-group">
                            <label for="inviteRole">Role *</label>
                            <select id="inviteRole" required>
                                <option value="">Select role...</option>
                                <option value="admin">Admin</option>
                                <option value="property_manager">Property Manager</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="viewer">Viewer</option>
                            </select>
                            <small style="color: #666; font-size: 12px;">Note: Super Admin role can only be assigned manually</small>
                        </div>
                        
                        <div class="form-group">
                            <label for="inviteTitle">Title</label>
                            <input type="text" id="inviteTitle" placeholder="e.g., Property Manager, Maintenance Lead">
                        </div>
                        
                        <div class="form-group">
                            <label for="inviteDepartment">Department</label>
                            <input type="text" id="inviteDepartment" placeholder="e.g., Operations, Maintenance">
                        </div>
                        
                        <h3 style="margin: 30px 0 20px 0; color: #667eea; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">Property Access</h3>
                        
                        <div class="form-group">
                            <label for="inviteProperties">Assigned Properties</label>
                            <div id="invitePropertiesCheckboxes" style="max-height: 300px; overflow-y: auto; border: 1px solid #e0e0e0; padding: 15px; border-radius: 6px; background: #f8f9fa;">
                                <p style="color: #999; font-style: italic;">Loading properties...</p>
                            </div>
                            <small style="color: #666; font-size: 12px;" id="invitePropertiesNote">Select properties this user will have access to. Admins have access to all properties.</small>
                        </div>
                        
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; font-weight: normal;">
                                <input type="checkbox" id="sendInviteEmail" checked>
                                <span>Send invitation email (user will receive instructions to set up their account)</span>
                            </label>
                        </div>
                        
                        <div class="form-actions">
                            <button type="submit" class="btn-primary">Create User & Send Invitation</button>
                            <button type="button" class="btn-secondary" id="cancelInviteUserForm">Cancel</button>
                        </div>
                    </form>
                    <div id="inviteUserError" class="auth-error" style="display: none; margin-top: 15px;"></div>
                </div>
            </div>
        </div>

        <!-- User Profile Page -->
        <div id="profilePage" class="page" style="display: none;">
            <div class="profile-container">
                <div class="profile-header">
                    <div class="profile-avatar-section">
                        <div class="profile-avatar" id="profileAvatar">
                            <span id="profileAvatarInitials">U</span>
                        </div>
                        <button class="btn-secondary" id="changeAvatarBtn" style="margin-top: 10px;">Change Photo</button>
                        <input type="file" id="avatarFileInput" accept="image/*" style="display: none;">
                    </div>
                    <div class="profile-header-info">
                        <h1 id="profileDisplayName">User Name</h1>
                        <p id="profileEmail" class="profile-email">user@example.com</p>
                        <div class="profile-badges">
                            <span class="profile-badge" id="profileRoleBadge">Viewer</span>
                            <span class="profile-badge" id="profileStatusBadge">Active</span>
                        </div>
                    </div>
                </div>

                <div class="profile-tabs">
                    <button class="profile-tab active" data-profile-tab="overview">Overview</button>
                    <button class="profile-tab" data-profile-tab="personal">Personal Information</button>
                    <button class="profile-tab" data-profile-tab="security">Security</button>
                    <button class="profile-tab" data-profile-tab="preferences">Preferences</button>
                </div>

                <div class="profile-content">
                    <!-- Overview Tab -->
                    <div id="profileOverviewTab" class="profile-tab-content active">
                        <div class="profile-section">
                            <h2>Account Overview</h2>
                            <div class="profile-info-grid">
                                <div class="info-card">
                                    <div class="info-label">Email</div>
                                    <div class="info-value" id="overviewEmail">‚Äî</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-label">Full Name</div>
                                    <div class="info-value" id="overviewName">‚Äî</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-label">Role</div>
                                    <div class="info-value" id="overviewRole">‚Äî</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-label">Status</div>
                                    <div class="info-value" id="overviewStatus">‚Äî</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-label">Phone</div>
                                    <div class="info-value" id="overviewPhone">‚Äî</div>
                                </div>
                                <div class="info-card">
                                    <div class="info-label">Member Since</div>
                                    <div class="info-value" id="overviewCreated">‚Äî</div>
                                </div>
                            </div>
                        </div>

                        <div class="profile-section">
                            <h2>Assigned Properties</h2>
                            <div id="profileAssignedProperties" class="properties-list">
                                <p style="color: #999; font-style: italic;">Loading properties...</p>
                            </div>
                        </div>

                        <div class="profile-section">
                            <h2>Recent Activity</h2>
                            <div id="profileRecentActivity" class="activity-list">
                                <p style="color: #999; font-style: italic;">No recent activity</p>
                            </div>
                        </div>
                    </div>

                    <!-- Personal Information Tab -->
                    <div id="profilePersonalTab" class="profile-tab-content">
                        <div class="profile-section">
                            <h2>Personal Information</h2>
                            <form id="profilePersonalForm">
                                <div class="form-group">
                                    <label for="profileFormDisplayName">Full Name *</label>
                                    <input type="text" id="profileFormDisplayName" required>
                                </div>
                                <div class="form-group">
                                    <label for="profileFormEmail">Email</label>
                                    <input type="email" id="profileFormEmail" readonly style="background: #f5f5f5; cursor: not-allowed;">
                                    <small style="color: #666; font-size: 12px;">Email cannot be changed. Contact an administrator if you need to update your email.</small>
                                </div>
                                <div class="form-group">
                                    <label for="profileFormPhone">Phone</label>
                                    <input type="tel" id="profileFormPhone">
                                </div>
                                <div class="form-group">
                                    <label for="profileFormTitle">Title</label>
                                    <input type="text" id="profileFormTitle" placeholder="e.g., Property Manager, Maintenance Lead">
                                </div>
                                <div class="form-group">
                                    <label for="profileFormDepartment">Department</label>
                                    <input type="text" id="profileFormDepartment" placeholder="e.g., Operations, Maintenance">
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn-primary">Save Changes</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- Security Tab -->
                    <div id="profileSecurityTab" class="profile-tab-content">
                        <div class="profile-section">
                            <h2>Password</h2>
                            <form id="profilePasswordForm">
                                <div class="form-group">
                                    <label for="profileCurrentPassword">Current Password *</label>
                                    <div class="password-input-wrapper">
                                        <input type="password" id="profileCurrentPassword" required>
                                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('profileCurrentPassword', this)">
                                            <span class="eye-icon">üëÅÔ∏è</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="profileNewPassword">New Password *</label>
                                    <div class="password-input-wrapper">
                                        <input type="password" id="profileNewPassword" required>
                                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('profileNewPassword', this)">
                                            <span class="eye-icon">üëÅÔ∏è</span>
                                        </button>
                                    </div>
                                    <small class="password-hint">Must be at least 8 characters with uppercase, lowercase, number, and special character</small>
                                </div>
                                <div class="form-group">
                                    <label for="profileConfirmPassword">Confirm New Password *</label>
                                    <div class="password-input-wrapper">
                                        <input type="password" id="profileConfirmPassword" required>
                                        <button type="button" class="password-toggle" onclick="togglePasswordVisibility('profileConfirmPassword', this)">
                                            <span class="eye-icon">üëÅÔ∏è</span>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn-primary">Update Password</button>
                                </div>
                            </form>
                        </div>

                        <div class="profile-section">
                            <h2>Email Verification</h2>
                            <div class="verification-status">
                                <p id="emailVerificationStatus">Checking verification status...</p>
                                <button type="button" class="btn-secondary" id="resendVerificationBtn" style="display: none;">Resend Verification Email</button>
                            </div>
                        </div>

                        <div class="profile-section">
                            <h2>Active Sessions</h2>
                            <div id="activeSessionsList">
                                <p style="color: #999; font-style: italic;">Session management coming soon...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Preferences Tab -->
                    <div id="profilePreferencesTab" class="profile-tab-content">
                        <div class="profile-section">
                            <h2>Display Preferences</h2>
                            <form id="profilePreferencesForm">
                                <div class="form-group">
                                    <label for="profileTheme">Theme</label>
                                    <select id="profileTheme">
                                        <option value="light">Light</option>
                                        <option value="dark">Dark</option>
                                        <option value="system">System Default</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="profileLanguage">Language</label>
                                    <select id="profileLanguage">
                                        <option value="en">English</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="profileTimezone">Timezone</label>
                                    <select id="profileTimezone">
                                        <option value="America/New_York">Eastern Time (ET)</option>
                                        <option value="America/Chicago">Central Time (CT)</option>
                                        <option value="America/Denver">Mountain Time (MT)</option>
                                        <option value="America/Los_Angeles">Pacific Time (PT)</option>
                                    </select>
                                </div>
                                <div class="form-group checkbox-group">
                                    <label>
                                        <input type="checkbox" id="profileEmailNotifications">
                                        <span>Email Notifications</span>
                                    </label>
                                </div>
                                <div class="form-group checkbox-group">
                                    <label>
                                        <input type="checkbox" id="profileDesktopNotifications">
                                        <span>Desktop Notifications</span>
                                    </label>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn-primary">Save Preferences</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
            </div> <!-- End container -->
        </div> <!-- End main-content-wrapper -->
    </div> <!-- End app-layout -->

    <!-- Floating Action Buttons -->
    <div class="fab-container">
        <button id="fabAddTenant" class="fab" title="Add Tenant" style="display: none;">
            <span class="fab-icon">+</span>
            <span class="fab-label">Add Tenant</span>
        </button>
        <button id="fabAddContact" class="fab" title="Add Contact" style="display: none;">
            <span class="fab-icon">+</span>
            <span class="fab-label">Add Contact</span>
        </button>
        <button id="fabAddBuilding" class="fab" title="Add Building" style="display: none;">
            <span class="fab-icon">+</span>
            <span class="fab-label">Add Building</span>
        </button>
        <button id="fabAddUnit" class="fab" title="Add Unit" style="display: none;">
            <span class="fab-icon">+</span>
            <span class="fab-label">Add Unit</span>
        </button>
        <button id="fabAddLease" class="fab" title="Add Lease" style="display: none;">
            <span class="fab-icon">+</span>
            <span class="fab-label">Add Lease</span>
        </button>
    </div>

    <!-- Firebase Config - Automatically selects config based on environment -->
    <script>
        // Auto-detect environment and load appropriate Firebase config
        (function() {
            const hostname = window.location.hostname;
            const isLocal = hostname === 'localhost' || hostname === '127.0.0.1';
            const isProduction = hostname === 'www.proppli.com' || hostname === 'proppli.com';
            const isStaging = hostname === 'staging.proppli.com';
            
            const urlParams = new URLSearchParams(window.location.search);
            const forceProd = urlParams.get('prod') === 'true';
            const forceStaging = urlParams.get('staging') === 'true';
            const forceDev = urlParams.get('dev') === 'true';
            
            // Determine which config to use
            let configFile;
            let environment;
            
            if (forceProd) {
                configFile = 'firebase-config.production.js';
                environment = 'PRODUCTION (forced)';
                console.log('üîµ Using PRODUCTION database (forced via ?prod=true)');
            } else if (forceStaging) {
                configFile = 'firebase-config.staging.js';
                environment = 'STAGING (forced)';
                console.log('üü° Using STAGING database (forced via ?staging=true)');
            } else if (forceDev) {
                configFile = 'firebase-config.development.js';
                environment = 'DEVELOPMENT (forced)';
                console.log('üü¢ Using DEVELOPMENT database (forced via ?dev=true)');
            } else if (isProduction) {
                configFile = 'firebase-config.production.js';
                environment = 'PRODUCTION';
                console.log('üîµ Using PRODUCTION database (www.proppli.com detected)');
            } else if (isStaging) {
                configFile = 'firebase-config.staging.js';
                environment = 'STAGING';
                console.log('üü° Using STAGING database (staging.proppli.com detected)');
            } else if (isLocal) {
                configFile = 'firebase-config.development.js';
                environment = 'DEVELOPMENT';
                console.log('üü¢ Using DEVELOPMENT database (localhost detected)');
            } else {
                // Fallback: default to development for unknown domains
                configFile = 'firebase-config.development.js';
                environment = 'DEVELOPMENT (fallback)';
                console.log('üü¢ Using DEVELOPMENT database (unknown domain, defaulting to dev)');
            }
            const script = document.createElement('script');
            script.src = configFile;
            
            // Wait for config to load before loading app.js
            script.onload = function() {
                console.log(`‚úÖ Config script loaded: ${configFile} (${environment})`);
                
                // Give it a moment for Firebase to initialize
                setTimeout(function() {
                    // Verify db is defined
                    if (typeof db === 'undefined') {
                        console.error('‚ùå Firebase db is not defined after loading config');
                        console.error('Firebase object:', typeof firebase !== 'undefined' ? 'exists' : 'missing');
                        console.error('Config file attempted:', configFile);
                        alert(`Error: Firebase configuration did not initialize properly.\n\nEnvironment: ${environment}\nConfig file: ${configFile}\n\nPlease check that the config file exists and contains valid Firebase credentials.`);
                        return;
                    }
                    
                    console.log('‚úÖ Firebase db is ready, loading app.js...');
                    
                    // Now load app.js after config is ready
                    const appScript = document.createElement('script');
                    appScript.src = 'app.js?v=8.0';
                    appScript.onload = function() {
                        console.log('‚úÖ app.js loaded successfully');
                    };
                    appScript.onerror = function() {
                        console.error('‚ùå Failed to load app.js');
                        alert('Error: Failed to load app.js. Please check the file exists.');
                    };
                    document.head.appendChild(appScript);
                }, 100);
            };
            
            script.onerror = function() {
                console.error('‚ùå Firebase config file not found:', configFile);
                console.error('Environment:', environment);
                console.error('Hostname:', hostname);
                
                // Try fallback to development config
                console.warn('‚ö†Ô∏è Attempting fallback to development config');
                const fallback = document.createElement('script');
                fallback.src = 'firebase-config.development.js';
                fallback.onload = function() {
                    if (typeof db === 'undefined') {
                        console.error('‚ùå Firebase db is not defined after loading fallback config');
                        alert(`Error: Firebase configuration file is missing or invalid.\n\nAttempted: ${configFile}\nFallback: firebase-config.development.js\n\nPlease ensure the config files exist and contain valid Firebase credentials.`);
                        return;
                    }
                    console.log('‚úÖ Fallback config loaded successfully');
                    const appScript = document.createElement('script');
                    appScript.src = 'app.js?v=8.0';
                    document.head.appendChild(appScript);
                };
                fallback.onerror = function() {
                    alert(`Error: Firebase configuration files are missing.\n\nPlease ensure the following files exist:\n- firebase-config.production.js\n- firebase-config.staging.js\n- firebase-config.development.js\n\nAnd that they contain valid Firebase credentials.`);
                };
                document.head.appendChild(fallback);
            };
            document.head.appendChild(script);
        })();
    </script>
    </div> <!-- End app-container -->
</body>
</html>

